### Тестовое задание BAUM Storage
В данном репозитории представлен код выполнения тестового задания от Baum Storage
Реализован простой веб-сервер на базе FastAPI, который принимает POST запрос с текстовым файлом в формате *TXT*, из которого извлекается заголовок из первой строки, затем в фоновом режиме этот файл построчно отправляет сообщения вида ```{'datetime': datetime, 'title': title, 'text': text}``` в RabbitMQ с интервалом 3 секунды между сообщениями. В отдельном цикле FastAPI просматривает наличие сообщений в очереди, в случае появления сообщения запускается обработчик, который валидирует данные, вычисляет количество букв *Х* (в обоих регистрах, русскоязычная) в строке текста, и сохраняет эти данные в БД PostgreSQL.

При выполнении GET запроса на эндпоинт */get_counter* Fastapi выполняет запрос к БД, группирует все записи по полю *title* и выводит список сообщений вида ```{'datetime': datetime, 'title': title, 'x_avg_count_in_line': x_avg_count_in_line}``` где *datetime* - время первой записи текста с названием *title*, *x_avg_count_in_line* - среднее значение счетчика буквы *Х* по всему тексту.

### Установка сервиса
Сервис реализован в виде докер-контейнеров. Для установки необходимо скачать репозиторий и перейти в папку с ним.
Перед запуском сервисов необходимо откорректировать переменные окружения в файлах *.yml директории docker-compose.

Для конфигурирования веб-сервера в файле **app.yml** нужно откорректировать следующие значения:
    - ***POSTGRES_USER*** - имя пользователя для подключения к БД (по умолчанию *postgres*)
    - ***POSTGRES_PASSWORD*** - пароль для подключения к БД (по умолчанию *postgres*)
    - ***POSTGRES_DB*** - имя БД, в которую будет осуществляться запись (по умолчанию *postgres*)
    - ***POSTGRES_HOST*** - IP адрес сервера БД (по умолчанию *localhost*)
    - ***POSTGRES_PORT*** - порт сервера БД (по умолчанию *5432*)
    - ***RABBIT_USER*** - имя пользователя для подключения к RabbitMQ (по умолчанию *guest*)
    - ***RABBIT_PASSWORD*** - пароль для подключения к БД (по умолчанию *guest*)
    - ***RABBIT_HOST*** - IP адрес сервера БД (по умолчанию *localhost*)
    - ***RABBIT_PORT*** - порт сервера БД (по умолчанию *5672*)
    - ***RABBIT_QUEUE*** - имя очереди для работы сервиса (по умолчанию *rabbit*)
    - ***RABBIT_EXCHANGE*** - имя распределителя сообщений (по умолчанию *rabbit*)
    - ***RABBIT_VHOST*** - виртуальный хост (по умолчанию */*)

Далее необходимо запустить сборку контейнера. При этом запустятся контейнеры с веб-сервером, сервером БД, и сервером RabbitMQ

        docker compose -f docker-compose/app.yml up -d

либо, при использовании UNIX системы короткую команду 

        make application

Сервис будет доступен по адресу - ***http://IP_adress:8888***
Тестовый вариант сервера также доступен по адресу ***https://test.gos-dom.ru***
